target_default: 1_site_data

packages:
  - yaml
  - dplyr
  - dataRetrieval
  - sbtools
  - mda.streams
  
sources:
  - ../1_site_data/code/create_site_table.R
  - ../1_site_data/code/init_site_list.R
  - ../1_site_data/code/sb_post_meta.R
  - ../1_site_data/code/sb_post_sites.R
  - ../lib/auth_from_profile.R
  - ../lib/load_profile.R
  - ../lib/write_status_table.R

targets:
  1_site_data:
    depends: 
      - sb_sites
      - sb_metadata
  
  ## Site List ##
  
  sites.config:
    command: yaml.load_file('../1_site_data/in/sites_config.yaml')
  
  # Get site list from SB & NWIS; stage to table
  ../1_site_data/out/site_list.tsv:
    command: create_site_table(sites.config, target_name)
  
  # Post sites and ensure they're posted; break at end unless they're fully posted
  sb_sites:
    command: sb_post_sites('../1_site_data/out/site_list.tsv')

  
  ## Metadata ##
  
  metadata:
    command: stage_meta_basic()
    depends: sb_sites
    
  sb_metadata: 
    command: sb_post_meta(metadata)
