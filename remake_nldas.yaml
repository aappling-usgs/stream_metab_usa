packages:
  - yaml
  - dplyr
  - geoknife
  - XML
  - doMC
  - foreach
  - powstreams
  
## All R files that are used must be listed here:
sources:
  - p1_import/code/00_subset_nldas.R
  - p1_import/code/00_load_internals.R

targets:
  all:
    depends: 
      - p1_import/out/nldas_nc_status.txt
      - nldas.ncml.sync

  internal.config:
    command: load_internal()
  
  nldas.config:
    command: yaml.load_file("configs/nldas_subset.yaml")
    
  sites:
    command: powstreams::list_sites()
    
  nldas.grids:
    command: nc_sub_grids(nldas.config)
  
  p1_import/out/nldas_nc_files.tsv:
    command: nldas_sub_files(nldas.grids, nldas.config, target_name)
    
  p1_import/out/nldas_nc_status.txt:
    command: nccopy_nldas('p1_import/out/nldas_nc_files.tsv', target_name, internal.config)
    
  server.files:
    command: nldas_server_files(nldas.config)
    depends:
      - p1_import/out/nldas_nc_status.txt
  
  p1_import/out/nldas.ncml:
    command: create_nldas_ncml(server.files, target_name)
  
  nldas.ncml.sync:
    command: sync_ncml('p1_import/out/nldas.ncml', internal.config)
    
  ##stage


